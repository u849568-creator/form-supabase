<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Gestion PRODUITS</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
    th { background: #f3f3f3; }
    input[type=text] { width: 160px; }
    button { margin: 2px; }
  </style>
</head>
<body>

<h2>ðŸ“¦ PRODUITS</h2>

<h3>âž• Ajouter un produit</h3>
<input id="ean" type="text" placeholder="EAN">
<button onclick="addProduit()">Ajouter</button>

<h3>ðŸ“‹ Liste des produits</h3>
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>EAN</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="rows"></tbody>
</table>

<script>
  const supabaseUrl = "https://cmwpwpiougayrizofnru.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtd3B3cGlvdWdheXJpem9mbnJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3ODQxMTUsImV4cCI6MjA4MzM2MDExNX0.wik4VvmF8oAasCZ6YZMbcrzaRKKYPMrYkZgb4en4E2A";
  const db = supabase.createClient(supabaseUrl, supabaseKey);

  async function loadProduits() {
    const { data, error } = await db
      .from("PRODUIT")
      .select("id, EAN")
      .order("id", { ascending: false });

    if (error) return alert(error.message);

    const tbody = document.getElementById("rows");
    tbody.innerHTML = "";

    data.forEach(p => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.id}</td>
        <td>
          <input type="text" value="${p.EAN}"
            onchange="updateProduit(${p.id}, this.value)">
        </td>
        <td>
          <button onclick="deleteProduit(${p.id})">ðŸ—‘</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  async function addProduit() {
    const EAN = document.getElementById("ean").value.trim();
    if (!EAN) return alert("EAN obligatoire");

    const { error } = await db
      .from("PRODUIT")
      .insert({ EAN });

    if (error) alert(error.message);
    else {
      document.getElementById("ean").value = "";
      loadProduits();
    }
  }

  async function updateProduit(id, EAN) {
    const { error } = await db
      .from("PRODUIT")
      .update({ EAN })
      .eq("id", id);

    if (error) alert(error.message);
  }

  async function deleteProduit(id) {
    if (!confirm("Supprimer ce produit ?")) return;

    const { error } = await db
      .from("PRODUIT")
      .delete()
      .eq("id", id);

    if (error) alert(error.message);
    else loadProduits();
  }

  loadProduits();
</script>

</body>
</html>
