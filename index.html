<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Accueil â€“ Produits</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { margin-bottom: 10px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 6px; }
    th { background: #f3f3f3; }
    input { width: 100%; box-sizing: border-box; }
    a { color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .filters th { background: #fafafa; }
  </style>
</head>
<body>

<h2>ðŸ“¦ Produits</h2>

<table>
  <thead>
    <!-- Ligne filtres -->
    <tr class="filters">
      <th>
        <input id="fEAN" placeholder="Rechercher EAN">
      </th>
      <th>
        <input id="fLIBELLE" placeholder="Rechercher libellÃ©">
      </th>
      <th>
        <input id="fCODE_S" placeholder="Rechercher code fournisseur">
      </th>
    </tr>
    <!-- En-tÃªtes -->
    <tr>
      <th>EAN</th>
      <th>LIBELLÃ‰</th>
      <th>CODE_S</th>
    </tr>
  </thead>
  <tbody id="rows"></tbody>
</table>

<script>
  /* =====================
     Connexion Supabase
     ===================== */
  const supabaseUrl = "https://XXXX.supabase.co";
  const supabaseKey = "ANON_PUBLIC_KEY";
  const db = supabase.createClient(supabaseUrl, supabaseKey);

  const rows = document.getElementById("rows");

  async function loadProduits() {
    let query = db
      .from("PRODUIT")
      .select('id, "EAN", "LIBELLE", "CODE_S"')
      .order("id", { ascending: false })
      .limit(20);

    if (fEAN.value) {
      query = query.ilike("EAN", `%${fEAN.value}%`);
    }
    if (fLIBELLE.value) {
      query = query.ilike("LIBELLE", `%${fLIBELLE.value}%`);
    }
    if (fCODE_S.value) {
      query = query.ilike("CODE_S", `%${fCODE_S.value}%`);
    }

    const { data, error } = await query;
    if (error) {
      alert(error.message);
      return;
    }

    rows.innerHTML = "";
    data.forEach(p => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>
          <a href="produit.html?id=${p.id}">
            ${p.EAN ?? ""}
          </a>
        </td>
        <td>${p.LIBELLE ?? ""}</td>
        <td>${p.CODE_S ?? ""}</td>
      `;
      rows.appendChild(tr);
    });
  }

  // Recharge Ã  chaque saisie (simple et efficace en V1)
  fEAN.oninput = loadProduits;
  fLIBELLE.oninput = loadProduits;
  fCODE_S.oninput = loadProduits;

  // Chargement initial
  loadProduits();
</script>

</body>
</html>
